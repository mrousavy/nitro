//
// Func_std__shared_ptr_margelo__nitro__test__external__HybridSomeExternalObjectSpec_.rs
// This file was generated by nitrogen. DO NOT MODIFY THIS FILE.
// https://github.com/mrousavy/nitro
// Copyright Â© Marc Rousavy @ Margelo
//
#![allow(
    non_camel_case_types,
    non_snake_case,
    dead_code,
    unused_imports,
    clippy::all
)]

use super::HybridSomeExternalObjectSpec::HybridSomeExternalObjectSpec;
use std::ffi;

/// FFI-safe wrapper for callback `Func_std__shared_ptr_margelo__nitro__test__external__HybridSomeExternalObjectSpec_`.
///
/// Wraps a C function pointer + userdata into a callable Rust struct.
/// The C++ side passes a function pointer and opaque userdata;
/// the Rust side can call it safely through this wrapper.
#[repr(C)]
pub struct Func_std__shared_ptr_margelo__nitro__test__external__HybridSomeExternalObjectSpec_ {
    fn_ptr: unsafe extern "C" fn(*mut std::ffi::c_void) -> *mut std::ffi::c_void,
    userdata: *mut std::ffi::c_void,
    destroy_fn: unsafe extern "C" fn(*mut std::ffi::c_void),
}

// Safety: The C++ side guarantees the function pointer and userdata
// are valid for the lifetime of this struct and are thread-safe.
unsafe impl Send
    for Func_std__shared_ptr_margelo__nitro__test__external__HybridSomeExternalObjectSpec_
{
}
unsafe impl Sync
    for Func_std__shared_ptr_margelo__nitro__test__external__HybridSomeExternalObjectSpec_
{
}

impl Func_std__shared_ptr_margelo__nitro__test__external__HybridSomeExternalObjectSpec_ {
    /// Create a new wrapper from a C function pointer, userdata, and destroy function.
    pub fn new(
        fn_ptr: unsafe extern "C" fn(*mut std::ffi::c_void) -> *mut std::ffi::c_void,
        userdata: *mut ffi::c_void,
        destroy_fn: unsafe extern "C" fn(*mut ffi::c_void),
    ) -> Self {
        Self {
            fn_ptr,
            userdata,
            destroy_fn,
        }
    }

    /// Call the wrapped function.
    pub unsafe fn call(&self) -> Box<dyn HybridSomeExternalObjectSpec> {
        unsafe {
            let __result = (self.fn_ptr)(self.userdata);
            *Box::from_raw(__result as *mut Box<dyn HybridSomeExternalObjectSpec>)
        }
    }
}

impl Drop for Func_std__shared_ptr_margelo__nitro__test__external__HybridSomeExternalObjectSpec_ {
    fn drop(&mut self) {
        unsafe {
            (self.destroy_fn)(self.userdata);
        }
    }
}
