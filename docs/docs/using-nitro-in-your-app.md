---
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Using Nitro in your app

While most libraries are built with Nitro and shipped over npm, you can also easily build a library with Nitro in your app - that's the "brownfield" way of doing things.

## Installing Nitro

First, you need to install the Nitro Modules core package from npm:

<Tabs groupId="package-manager">
  <TabItem value="npm" label="npm" default>
    ```sh
    npm i react-native-nitro-modules
    cd ios && pod install
    ```
  </TabItem>
  <TabItem value="yarn" label="yarn">
    ```sh
    yarn add react-native-nitro-modules
    cd ios && pod install
    ```
  </TabItem>
  <TabItem value="pnpm" label="pnpm">
    ```sh
    pnpm add react-native-nitro-modules
    cd ios && pod install
    ```
  </TabItem>
  <TabItem value="bun" label="bun">
    ```sh
    bun i react-native-nitro-modules
    cd ios && pod install
    ```
  </TabItem>
</Tabs>

## Creating a Hybrid Object

After installing Nitro, you can start creating your [Hybrid Objects](hybrid-objects) - either with [Nitrogen](nitrogen), or manually:

<Tabs groupId="nitrogen-or-not">
  <TabItem value="nitrogen" label="With Nitrogen ✨" default>

  Nitrogen will ✨ automagically ✨ generate native specifications for each Hybrid Object based on a given TypeScript definition.

  ### 1. Installing Nitrogen

  First, install Nitrogen:

  <Tabs groupId="package-manager">
    <TabItem value="npm" label="npm" default>
      ```sh
      npm i nitrogen --save-dev
      ```
    </TabItem>
    <TabItem value="yarn" label="yarn">
      ```sh
      yarn add nitrogen -D
      ```
    </TabItem>
    <TabItem value="pnpm" label="pnpm">
      ```sh
      pnpm add nitrogen -D
      ```
    </TabItem>
    <TabItem value="bun" label="bun">
      ```sh
      bun i nitrogen -d
      ```
    </TabItem>
  </Tabs>

  Then, create your `nitro.json` configuration in your app's root directory:

  ```json
  {
    "cxxNamespace": ["example"],
    "ios": {
      "iosModulename": "NitroExample"
    },
    "android": {
      "androidNamespace": ["example"],
      "androidCxxLibName": "NitroExample"
    },
    "autolinking": {}
  }
  ```

  Note: Replace `Example` with your app's name.

  Now you need to add the autolinking setup for all nitrogen components:

  #### iOS

  For iOS, you need to add everything in `nitrogen/generated/ios` and `nitrogen/generated/shared` to your Xcode project.

  You can either do this:
  - A) manually, by dragging the folder into Xcode and adding the sources, or
  - B) automatically, via a local `<<name>>.podspec` that acts as a local pod. In this local pod you need to include the autolinking code that has been generated by Nitrogen:
      ```ruby
      load 'nitrogen/generated/ios/NitroExample+autolinking.rb'
      add_nitrogen_files(s)
      ```
      And then just add this local Pod to your `Podfile`:
      ```ruby
      pod '<<name>>', :path => '../'
      ```

  #### Android

  For Android, you need to add everything in `nitrogen/generated/android` and `nitrogen/generated/shared` to your build.gradle (Java/Kotlin source), or CMake (C++ sources) project.

  ##### Java/Kotlin sources (`build.gradle`)

  Add the Java/Kotlin sources to your Gradle project by including the generated autolinking gradle file. Simply add this to the top of your `app/build.gradle`:

  ```groovy
  apply from: '../nitrogen/generated/android/NitroExample+autolinking.gradle'
  ```

  ##### C++ sources (`CMakeLists.txt`)

  Add the C++ sources to your CMake project by including the generated autolinking CMake file. If you do not have a CMake setup yet, make sure to configure CMake through `externalNativeBuild` in `build.gradle`. Simply add this to your `CMakeLists.txt`:

  ```cmake
  include(${CMAKE_SOURCE_DIR}/../nitrogen/generated/android/NitroImage+autolinking.cmake)
  ```

  ### 2. Creating Nitro specs

  After Nitrogen has been successfully set up, create your first spec. Let's create `Math.nitro.ts`:

  ```ts title="Math.nitro.ts"
  interface Math extends HybridObject<{ ios: 'swift', android: 'kotlin' }> {
    readonly pi: number
    add(a: number, b: number): number
  }
  ```

  And now let's run Nitrogen:

  ```sh
  npm run nitrogen
  ```

  This will generate the native Swift and Kotlin protocol "`HybridMathSpec`", which now just needs to be implemented in a class:

  <Tabs groupId="native-language">
    <TabItem value="swift" label="Swift" default>
      ```swift title="HybridMath.swift"
      class HybridMath : HybridMathSpec {
        public var hybridContext = margelo.nitro.HybridContext()
        public var memorySize: Int {
          return getSizeOf(self)
        }

        public var pi: Double {
          return Double.pi
        }
        public func add(a: Double, b: Double) throws -> Double {
          return a + b
        }
      }
      ```
    </TabItem>
    <TabItem value="kotlin" label="Kotlin">
      ```kotlin title="HybridMath.kt"
      class HybridMath : HybridMathSpec() {
        override val memorySize: Long
            get() = 0L

        override var pi: Double
          get() = Double.PI

        override fun add(a: Double, b: Double): Double {
          return a + b
        }
      }
      ```
    </TabItem>
  </Tabs>

  ### 3. Registering the Hybrid Objects

  Nitro needs to be able to initialize an instance of your Hybrid Object - so we need to tell it how to do that.
  In your `nitro.json`, register `HybridMath` in the `"autolinking"` section:
  <Tabs>
    <TabItem value="swift-kotlin" label="Swift/Kotlin" default>
      ```json
      {
        ...
        "autolinking": {
          "Math": {
            "swift": "HybridMath",
            "kotlin": "HybridMath"
          }
        }
      }
      ```

      :::warning
      - Make sure `HybridMath` is default-constructible. That is, it has a public initializer that takes no arguments.
      :::
    </TabItem>
    <TabItem value="cpp" label="C++">
      ```json
      {
        ...
        "autolinking": {
          "Math": {
            "cpp": "HybridMath"
          }
        }
      }
      ```

      :::warning
      - Make sure `HybridMath` is default-constructible. That is, it has a public constructor that takes no arguments.
      - Make sure the `HybridMath` class is defined in a header named `HybridMath.hpp` - this is what Nitro will import.
      - Also make sure `HybridMath` is either in the global namespace, or in `margelo::nitro::<cxxNamespace>` (configured in `nitro.json`).
      :::
    </TabItem>
  </Tabs>

  For more information, see the [Nitrogen documentation](nitrogen).

  </TabItem>
  <TabItem value="manually" label="Manually">

  Manually creating Hybrid Objects is quite easy, but since Nitro is a C++ library, you need to use C++.
  You can bridge the implementations of those methods to Swift/Objective-C/Java/Kotlin/Rust yourself, but Nitrogen usually does all of that ✨ automagically ✨.

  Simply create your C++ classes and inherit from `HybridObject`:

  <div className="side-by-side-container">
    <div className="side-by-side-block">
      ```cpp title="HybridMath.hpp"
      class HybridMath: public HybridObject {
      public:
        HybridMath(): HybridObject(NAME) { }

      public:
        double add(double a, double b);

      protected:
        void loadHybridMethods() override;

      private:
        static constexpr auto NAME = "Math";
      };
      ```
    </div>
    <div className="side-by-side-block">
      ```cpp title="HybridMath.cpp"
      double HybridMath::add(double a, double b) {
        return a + b;
      }

      void HybridMath::loadHybridMethods() {
        // register base methods (toString, ...)
        HybridObject::loadHybridMethods();
        // register custom methods (add)
        registerHybrids(this, [](Prototype& proto) {
          proto.registerHybridMethod(
            "add",
            &HybridMath::add
          );
        });
      }
      ```
    </div>
  </div>

  Then, register the Hybrid Object constructor somewhere on app startup - e.g. in `AppDelegate`'s `application:didFinishLaunchingWithOptions:`, or in your `cpp-adapter`'s JNI on load:

  ```cpp
  HybridObjectRegistry::registerHybridObjectConstructor(
    "Math",
    []() -> std::shared_ptr<HybridObject> {
      return std::make_shared<HybridMath>();
    }
  );
  ```

  </TabItem>
</Tabs>

## Using your Hybrid Objects

And finally, to initialize `HybridMath` from JS you just need to call `createHybridObject`:

```ts
export const MathModule = NitroModules.createHybridObject<Math>("Math")
const result = MathModule.add(5, 7)
```

:::note
If this call failed, you might have forgotten to register your Hybrid Object's constructor in the `HybridObjectRegistry`.
:::
